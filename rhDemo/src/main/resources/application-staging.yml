spring:
  security:
    oauth2:
      client:
        registration:
          keycloak:
            client-id: ${RHDEMO_CLIENT_REGISTRATION_KEYCLOAK_CLIENT_ID:RHDemo}
            client-secret: ${RHDEMO_CLIENT_REGISTRATION_KEYCLOAK_CLIENT_SECRET}
            client-authentication-method: client_secret_post
            scope: openid
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
        provider:
          keycloak:
            # URL publique HTTPS pour le navigateur (redirection login)
            authorization-uri: https://keycloak.staging.local/realms/RHDemo/protocol/openid-connect/auth

            # URLs internes HTTP pour les appels serveur Spring Boot → Keycloak
            # (échange code→token, récupération JWKS)
            # Utilise l'alias Docker "keycloak-staging" pour accès réseau interne
            token-uri: http://keycloak-staging:8080/realms/RHDemo/protocol/openid-connect/token
            jwk-set-uri: http://keycloak-staging:8080/realms/RHDemo/protocol/openid-connect/certs

            # Configuration de l'issuer attendu dans le JWT
            # IMPORTANT: Doit correspondre à l'issuer généré par Keycloak (HTTPS public)
            issuer-uri: https://keycloak.staging.local/realms/RHDemo

            user-name-attribute: preferred_username
      resourceserver:
        jwt:
          # JWKS en HTTP interne pour validation des signatures JWT
          jwk-set-uri: http://keycloak-staging:8080/realms/RHDemo/protocol/openid-connect/certs

          # Issuer attendu dans les tokens JWT (doit matcher l'issuer du token)
          issuer-uri: https://keycloak.staging.local/realms/RHDemo

# Configuration serveur pour reverse proxy
server:
  # Utiliser les headers X-Forwarded-* de nginx pour construire les URLs correctes
  forward-headers-strategy: framework

# Logging pour debug
logging:
  level:
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG
    org.springframework.security.oauth2: TRACE
    org.springframework.web.client: DEBUG
