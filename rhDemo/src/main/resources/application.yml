spring:
  application:
    name: rhdemoAPI

  # Import des secrets depuis fichiers externes
  # En dev local: créer secrets/secrets.yml depuis secrets.yml.template
  config:
    import:
      - optional:file:./secrets/secrets.yml

  # PostgreSQL (prod)
  datasource:
    url: jdbc:postgresql://localhost:5432/dbrhdemo
    username: dbrhdemo
    password: ${rhdemo.datasource.password.pg}
    driver-class-name: org.postgresql.Driver
  
  # Evite l'ecrasement du schema data.sql par JPA
  jpa:
    hibernate:
      ddl-auto: validate
  
  # OAuth2 / Keycloak
  # Configuration pour développement local
  # Pour staging, voir application-staging.yml
  # Pour production, surcharger via variables d'environnement
  security:
    oauth2:
      client:
        registration:
          keycloak:
            client-id: ${SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_KEYCLOAK_CLIENT_ID:RHDemo}
            client-secret: ${rhdemo.client.registration.keycloak.client.secret}
            client-authentication-method: client_secret_post
            scope: openid
            authorization-grant-type: authorization_code
            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"
        provider:
          keycloak:
            # Environnement local: Keycloak sur localhost:6090 (docker-compose local)
            # Endpoints publics pour redirections navigateur
            authorization-uri: http://localhost:6090/realms/RHDemo/protocol/openid-connect/auth
            # Endpoints backend pour communication serveur (même URL en local)
            token-uri: http://localhost:6090/realms/RHDemo/protocol/openid-connect/token
            jwk-set-uri: http://localhost:6090/realms/RHDemo/protocol/openid-connect/certs
            user-name-attribute: preferred_username
      resourceserver:
        jwt:
          # JWK pour validation des tokens JWT
          jwk-set-uri: http://localhost:6090/realms/RHDemo/protocol/openid-connect/certs

server:
  port: 9000
  # Support des headers X-Forwarded-* si derrière un reverse proxy
  # En local direct, cette option est ignorée
  forward-headers-strategy: framework

# Niveau de log
logging:
  level:
    root: INFO
    fr.leuwen: INFO
    org.springframework.boot.web.embedded.tomcat: INFO
    org.springframework.boot.actuate: INFO
    org.springframework.security: INFO
  
  # Pattern de log avec timestamp
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} -- %msg%n'
    file: '%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} -- %msg%n'

# Endpoints Actuator disponibles
management:
  endpoints:
    web:
      exposure:
        include: '*'

# SpringDoc / Swagger
springdoc:
  api-docs:
    path: /api-docs/docs
  swagger-ui:
    path: /api-docs/swagger-ui

# Propriétés custom
fr:
  leuwen:
    rhdemoAPI:
      messagelancement: Lancement de l'application RH Demo
