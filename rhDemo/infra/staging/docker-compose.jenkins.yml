# ═══════════════════════════════════════════════════════════════
# Docker Compose Override pour Jenkins CI/CD
# 
# Ce fichier override le docker-compose.yml principal pour
# utiliser l'image Docker buildée par Maven/Paketo au lieu
# de rebuilder depuis le contexte.
#
# Usage dans Jenkins:
#   docker compose -f docker-compose.yml \
#                  -f docker-compose.jenkins.yml \
#                  up -d
#
# Variables attendues dans .env:
#   RHDEMO_IMAGE=rhdemo-api:0.0.1-SNAPSHOT-123
# ═══════════════════════════════════════════════════════════════

services:
  # Override de l'application RHDemo
  # Utilise l'image buildée au lieu de build context
  rhdemo-app:
    image: ${RHDEMO_IMAGE:-rhdemo-api:0.0.1-SNAPSHOT}
    # La directive 'build' du docker-compose.yml est automatiquement ignorée
    # quand 'image' est défini ici
    
    # Override uniquement pour les tests CI/CD (logs verbeux)
    # Toute la configuration OAuth2 est dans application-staging.yml (packagé dans le JAR)
    environment:
      # Logging verbeux pour debug tests
      - LOGGING_LEVEL_ROOT=INFO
      - LOGGING_LEVEL_FR_LEUWEN=DEBUG

