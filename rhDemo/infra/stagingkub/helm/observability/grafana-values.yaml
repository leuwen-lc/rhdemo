# Configuration Grafana
# Chart: grafana/grafana v8.x
# Date: 2025-12-31

###########################################
# Admin (À CONFIGURER AVANT INSTALLATION)
###########################################
adminUser: admin
# ⚠️ SÉCURITÉ: Définir un mot de passe fort avant installation
# adminPassword doit être défini avec un mot de passe sécurisé
# Exemple: openssl rand -base64 32
adminPassword: ""  # TODO: Renseigner un mot de passe fort

###########################################
# Resources
###########################################
resources:
  requests:
    cpu: 250m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

###########################################
# Persistence
###########################################
persistence:
  enabled: false

###########################################
# Ingress (désactivé - utilisation de Gateway API)
###########################################
# NOTE: Depuis la migration vers NGINX Gateway Fabric, on utilise
# Gateway + HTTPRoute au lieu de Ingress. Voir grafana-gateway.yaml
ingress:
  enabled: false

###########################################
# Datasources
###########################################
datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: Loki
        type: loki
        uid: loki
        access: proxy
        url: http://loki-gateway:80
        isDefault: true
        jsonData:
          maxLines: 1000
      - name: Prometheus
        type: prometheus
        uid: prometheus
        access: proxy
        url: http://prometheus-kube-prometheus-prometheus.monitoring.svc:9090
        isDefault: false
        editable: true
        jsonData:
          timeInterval: 30s

###########################################
# Dashboards
###########################################
# Activer le sidecar pour charger les dashboards depuis ConfigMaps
sidecar:
  dashboards:
    enabled: true
    label: grafana_dashboard
    labelValue: "1"
    folder: /tmp/dashboards
    defaultFolderName: General
    searchNamespace: ALL
    provider:
      foldersFromFilesStructure: true

# dashboardProviders removed - the sidecar automatically creates its own provider
# to avoid duplicate dashboard loading

dashboards: {}

###########################################
# Configuration
###########################################
grafana.ini:
  server:
    domain: grafana-stagingkub.intra.leuwen-lc.fr
    root_url: https://grafana-stagingkub.intra.leuwen-lc.fr
  analytics:
    reporting_enabled: false
    check_for_updates: false
  users:
    allow_sign_up: false
  auth.anonymous:
    enabled: false

###########################################
# Plugins
###########################################
plugins:
  - grafana-piechart-panel

###########################################
# ServiceMonitor
###########################################
serviceMonitor:
  enabled: false
